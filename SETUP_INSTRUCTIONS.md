# Character Management Setup Instructions

## AWS Setup Required

### 1. Create S3 Bucket for Images

1. Go to AWS Console → S3 → Create bucket
2. Bucket name: `dream-creator-images` (or your choice)
3. Region: `ap-south-1` (same as Lambda)
4. Keep "Block all public access" ENABLED (bucket stays private)
5. Click "Create bucket"

Note: Images are accessed via presigned URLs generated by Lambda, so the bucket remains private and secure.

### 2. Create DynamoDB Tables

**Characters Table:**
1. Go to AWS Console → DynamoDB → Create table
2. Table name: `dream_characters`
3. Partition key: `character_id` (String)
4. Click "Create table"

**Dreams Table:**
1. Create another table
2. Table name: `dream_videos`
3. Partition key: `dream_id` (String)
4. Click "Create table"

### 3. Update Lambda Function

1. Go to AWS Lambda → Your `dream_creator` function
2. Replace the code with the updated `lambda/dream_creater.py`
3. Make sure the Lambda has permissions for both tables:
   - `dream_users`
   - `dream_characters`

### 4. Lambda IAM Permissions

Ensure your Lambda execution role has these permissions:
```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "dynamodb:PutItem",
        "dynamodb:GetItem",
        "dynamodb:Scan",
        "dynamodb:DeleteItem"
      ],
      "Resource": [
        "arn:aws:dynamodb:ap-south-1:*:table/dream_users",
        "arn:aws:dynamodb:ap-south-1:*:table/dream_characters",
        "arn:aws:dynamodb:ap-south-1:*:table/dream_videos"
      ]
    },
    {
      "Effect": "Allow",
      "Action": [
        "s3:PutObject",
        "s3:GetObject",
        "s3:DeleteObject",
        "s3:ListBucket"
      ],
      "Resource": [
        "arn:aws:s3:::dream-creator-images",
        "arn:aws:s3:::dream-creator-images/*"
      ]
    },
    {
      "Effect": "Allow",
      "Action": [
        "bedrock:InvokeModel"
      ],
      "Resource": "arn:aws:bedrock:us-east-1::foundation-model/amazon.nova-reel-v1:0"
    }
  ]
}
```

### 5. Lambda Configuration

**Timeout:** Increase to 5 minutes (for Bedrock calls)
1. Go to Lambda → Configuration → General configuration
2. Edit timeout to 300 seconds

**Environment Variables:**
1. Go to Lambda → Configuration → Environment variables
2. Add: `S3_BUCKET` = `dream-creator-images`
3. Add: `BEDROCK_VIDEO_BUCKET` = `bedrock-video-generation-us-east-1-5xyt1p`

### 6. Enable Bedrock Model Access

1. Go to AWS Bedrock console (us-east-1 region)
2. Model access → Enable access to Amazon Nova Reel model

## Run the App

```bash
streamlit run app.py
```

## Features Added

- ✅ Create characters with name, description, and up to 3 images
- ✅ View all your characters
- ✅ Delete characters (also deletes S3 images)
- ✅ Images stored in private S3 bucket
- ✅ Secure access via presigned URLs (1 hour expiry)
- ✅ Max 3 images per character enforced
- ✅ Dream video generation with Amazon Nova Reel
- ✅ Low-cost settings: 2 sec, 360p, 12fps
- ✅ Dream history with status tracking
